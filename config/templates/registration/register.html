{% extends 'base.html' %}
{% block content %}
{% load custom_filters %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h1 class="text-center mb-4">회원가입</h1>
            <div class="card shadow-sm">
                <div class="card-body">
                    <form action="" method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- 회원 유형 선택 -->
                        <div class="mb-3">
                            <label class="form-label">회원 유형</label>
                            <div class="d-flex align-items-center">
                                <input type="radio" id="student" name="user_type" value="student" checked>
                                <span class="ms-2">학생이에요</span>
                                <i class="fas fa-check-circle ms-2" style="color: green;"></i>
                            </div>
                            <div class="d-flex align-items-center mt-2">
                                <input type="radio" id="academy" name="user_type" value="academy">
                                <span class="ms-2">학원입니다</span>
                                <i class="fas fa-check-circle ms-2" style="color: green; display: none;"></i>
                            </div>
                        </div>

                        {% for field in form %}
                        <div class="mb-3">
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                            {{ field|add_class:"form-control" }}
                            {% if field.errors %}
                            <div class="text-danger small mt-1">
                                {% for error in field.errors %}
                                <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                        
                        <!-- 사업자등록증 업로드 필드 -->
                        <div id="business-registration" class="mb-3" style="display: none;">
                            <label for="business_registration" class="form-label">사업자등록증 업로드</label>
                            <input type="file" id="business_registration" name="business_registration" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                        </div>

                        

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">회원가입</button>
                        </div>
                        <div class="text-center mt-3">
                            <small>이미 계정이 있으신가요? <a href="{% url 'login' %}">로그인</a></small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 라디오 버튼 선택 시 체크 아이콘 표시 및 사업자등록증 업로드 필드 표시
    const radios = document.querySelectorAll('input[name="user_type"]');
    const businessRegistrationField = document.getElementById('business-registration');

    radios.forEach(radio => {
        radio.addEventListener('change', function() {
            // 모든 체크 아이콘 숨기기
            document.querySelectorAll('.fa-check-circle').forEach(icon => {
                icon.style.display = 'none';
            });
            // 선택된 라디오 버튼의 체크 아이콘 표시
            if (this.checked) {
                this.nextElementSibling.nextElementSibling.style.display = 'inline';
            }

            // 사업자등록증 업로드 필드 표시/숨기기
            if (this.value === 'academy') {
                businessRegistrationField.style.display = 'block';
            } else {
                businessRegistrationField.style.display = 'none';
            }
        });
    });

    // 페이지 로드 시 기본값으로 수강생 체크 아이콘 표시
    document.querySelector('input[name="user_type"]:checked').nextElementSibling.nextElementSibling.style.display = 'inline';
</script>
{% endblock %}